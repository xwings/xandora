<?php

require Kohana::find_file('vendor', 'gviz/gviz_api');

// hashing for optimization
$sig  = md5(serialize($country_set));
$Gviz = new GvizDataTable("sig:$sig");
$Gviz->addColumn('country', 'Country', 'string');
$Gviz->addColumn('total', 'Threat Counter', 'number');

foreach ( $country_set as $country )
{
    $rowId = $Gviz->newRow();
    $Gviz->addCell($rowId, 'country', $country->country);
    $Gviz->addCell($rowId, 'total', $country->count);
}
echo $Gviz->toJsonResponse();
